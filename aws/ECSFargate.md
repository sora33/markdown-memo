# ECS Fargate, RDSの構成について
## Dockerの運用
- Dockerは、OSとAPPの間で、コンテナエンジを稼働する環境を提供するのみ
- Dcokerをオーケストレーションで運用することで、可用性が向上する
  - ECSやKubenetesが該当する


## CICDの概要
- 開発やリリースの課題
  - システム統合時の不具合
  - デプロイコスト
- ICCDを使うことで
  - ビルドやテストを自動化
  - 自動デプロイされる
- メリデメ
  - メリット
    - システム統合の迅速化
    - 人的ミスの防止
  - デメリット
    - デプロイ方法の毒メントが必要
    - テストコード作成にコストがかかる

## ECSについて
フルマネージドなコンテナオーケストレーションサービス

### クラスター
サービスを管理するための論理的なグループ

### サービス
タスクを管理するための概念外年
ELBと連携して、各タスクにトラフィックを分散
タスク数を定義
オーケストレーション

### タスク定義
タスクの実行定義
リソース（CPU/メモリ）の割り当て
タスクごとにIAMロールやネットワーク等を設定
- タスクロール
  - 起動されたタスク（app）に割り当てられるロール
  - DBにアクセスするための権限。
- タスク実行ロール
  - タスクを実行するECSのリソースが使用するロール
  - 例：ログ出力やECRからイメージを取得する権限

### タスク
コンテナを管理するための概念
タスク定位に基づき実行される
タスク内コンテナは、同一コンテナ上で行われる

## VPC
ネットワーク空間のこと。

## IAMロール
AWSリソースにアタッチできる。
## IAMポリシー
どのAWSサービスの、どのリソースに対して、どのような操作を、許可するしない


## Cokd４兄弟
### AWS Code Commit
Gitベースのリポジトリをセキュアにホストする。gitコマンドを使える。
IAMを設定できる。
### AWS Code Build
ソースコードをコンパイル、テストを実行、デプロイ可能なパッケージを作成
### AWS Code Deploy
blue/green デプロイを実現できる。
### AWS Code Pypeline
ソースコードの変更を検知して、ビルド・テスト・デプロイを自動で実行できる。
### 流れ
1. ソースコードをAWS Code Commitにpush
2. Code Pipelineが変更を検知
3. Code build がDockerイメージをビルドし、ECRにpush
4. Code Deploy がECRのDockerイメージをECSのクラスにデプロイ
  
### Blue/Greenデプロイメントについて
- 通常のデプロイは、一時的にサーバーを停止する。
- Blue/Greenデプロイメントは停止なし。
  -  ELBが古いタスクをむいている。（Blue）
  -  Code Deployで新しいタスクを作る。（Green）
  -  ELBをGreenに向ける。Blueを削除する（一定期間、ロールバックできるように保持）



## Github Actionsについて
- Githubリポジトリの操作（push, merge）をトリガーにワークフローを実行
- 仮想マシン内でワークフローを実行





